// build.js v2.0 - Claude Sonnet 4.5
// Production build script with Tailwind CSS compilation
// 1. Compiles and minifies Tailwind CSS
// 2. Bundles server code
// 3. Copies all public assets to dist directory

import { $ } from "bun";
import { cpSync, rmSync, existsSync, mkdirSync } from "fs";

console.log("ğŸ§¹ Cleaning dist directory...");
if (existsSync("./dist")) {
  rmSync("./dist", { recursive: true, force: true });
}
mkdirSync("./dist");

// Step 1: Build Tailwind CSS (minified for production)
console.log("ğŸ¨ Building Tailwind CSS...");
await $`bunx @tailwindcss/cli -i ./public/styles/input.css -o ./public/styles/output.css --minify`;
console.log("   âœ“ Tailwind CSS compiled and minified");

// Step 2: Build server bundle
console.log("ğŸ”¨ Building server bundle...");
await $`bun build ./src/server.js --outdir ./dist --target bun`;
console.log("   âœ“ Server bundled");

// Step 3: Copy all public assets (including the compiled CSS)
console.log("ğŸ“ Copying public assets...");
cpSync("./public", "./dist/public", { recursive: true });
console.log("   âœ“ Public assets copied");

console.log("\nâœ… Build complete! Ready for deployment.");
console.log("\nğŸ“¦ Deployment files created in ./dist/");
console.log("   ./dist/server.js           - Bundled server");
console.log("   ./dist/public/             - Static files");
console.log("   ./dist/public/styles/      - Compiled & minified CSS");
console.log("\nğŸ§ª To test the production build:");
console.log("   bun run start");
console.log("\nğŸ“Š Build Stats:");
console.log("   CSS: Compiled & minified with Tailwind");
console.log("   JS:  Bundled (not minified)");
```

## Project Structure

Your project should now look like this:
````your-project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.js          # Main server file
â”‚   â”œâ”€â”€ db.js              # Database modules
â”‚   â””â”€â”€ ...
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html         # HTML files
â”‚   â”œâ”€â”€ app.js             # Client-side JavaScript
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ input.css      # Tailwind source file (you edit this)
â”‚   â”‚   â””â”€â”€ output.css     # Generated by Tailwind (gitignored)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ dist/                  # Production build (gitignored)
â”‚   â”œâ”€â”€ server.js
â”‚   â””â”€â”€ public/
â”‚       â””â”€â”€ styles/
â”‚           â””â”€â”€ output.css # Minified production CSS
â”œâ”€â”€ dev.js                 # Development launcher
â”œâ”€â”€ build.js               # Production build script
â”œâ”€â”€ package.json
â”œâ”€â”€ tailwind.config.js     # Tailwind configuration
â””â”€â”€ .gitignore`;
